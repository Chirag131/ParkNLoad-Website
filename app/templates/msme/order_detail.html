{% extends "base.html" %}

{% block title %}Order Detail{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<link rel="stylesheet" href="{{ url_for('static', filename='css/orderDetail.css') }}">
{% endblock %}

{% block content %}
<div class="container order-detail-page">
    <div class="page-header">
        <div class="header-content">
            <h2>Order #{{ order.id }}</h2>
            <div class="header-actions">
                <a href="{{ url_for('msme.orders') }}" class="btn btn-outline">‚Üê Back to Orders</a>
                <a href="{{ url_for('msme.add_order') }}" class="btn btn-primary">Add New Order</a>
            </div>
        </div>
    </div>

    <div class="order-detail-container">
        <!-- Map Container -->
        <div class="map-container">
            <div class="map-header">
                <div class="map-title">Route Visualization</div>
                <div class="map-controls">
                    <button class="map-btn" onclick="refreshMap()">Refresh</button>
                    <button class="map-btn" onclick="openFullMap()">Full View</button>
                </div>
            </div>
            <div class="map-display">
                <div id="orderMap" data-pickup="{{ order.pickup_address }}" data-delivery="{{ order.delivery_address }}"></div>
            </div>
        </div>

        <!-- Order Overview -->
        <div class="order-overview">
            <div class="overview-header">
                <h3>Order Overview</h3>
                <div class="header-badges">
                    <span class="order-type-badge {{ order.order_type }}">
                        {% if order.order_type == 'incoming' %}
                            üîÑ Incoming
                        {% else %}
                            üì§ Outgoing
                        {% endif %}
                    </span>
                    <span class="priority-badge {{ order.package_priority }}">
                        {{ order.package_priority|title }}
                    </span>
                </div>
            </div>
            
            <div class="overview-grid">
                <div class="overview-item">
                    <label>Order ID</label>
                    <span>#{{ order.id }}</span>
                </div>
                <div class="overview-item">
                    <label>Order Date</label>
                    <span>{{ order.date.strftime('%d-%m-%Y') }}</span>
                </div>
                <div class="overview-item">
                    <label>Time Slot</label>
                    <span>{{ order.time_slot }}</span>
                </div>
                <div class="overview-item">
                    <label>Order Type</label>
                    <span class="order-type-text {{ order.order_type }}">
                        {% if order.order_type == 'incoming' %}
                            Incoming Order
                        {% else %}
                            Outgoing Order
                        {% endif %}
                    </span>
                </div>
                <div class="overview-item">
                    <label>Package Name</label>
                    <span>{{ order.package_name }}</span>
                </div>
                <div class="overview-item">
                    <label>Quantity</label>
                    <span>{{ order.quantity }}</span>
                </div>
            </div>
        </div>

        <!-- Warehouse Information -->
        <div class="detail-section">
            <h3>Warehouse Information</h3>
            <div class="warehouse-info">
                <div class="warehouse-details">
                    <h4>{{ order.warehouse.name }}</h4>
                    <p><strong>Address:</strong> {{ order.warehouse.address }}</p>
                    <p><strong>Contact:</strong> {{ order.warehouse.contact_person }}</p>
                    <p><strong>Phone:</strong> {{ order.warehouse.phone }}</p>
                    <p><strong>Email:</strong> {{ order.warehouse.email }}</p>
                </div>
                <div class="warehouse-status">
                    <span class="status-badge active">Active</span>
                </div>
            </div>
        </div>

        <!-- Package Details -->
        <div class="detail-section">
            <h3>Package Details</h3>
            <div class="package-details">
                <div class="detail-item">
                    <label>Package Name:</label>
                    <span>{{ order.package_name }}</span>
                </div>
                <div class="detail-item">
                    <label>Package Type:</label>
                    <span>{{ order.package_type|title }}</span>
                </div>
                <div class="detail-item">
                    <label>Quantity:</label>
                    <span>{{ order.quantity }}</span>
                </div>
                {% if order.package_description %}
                <div class="detail-item">
                    <label>Description:</label>
                    <span>{{ order.package_description }}</span>
                </div>
                {% endif %}
            </div>
        </div>

        <!-- Location Information -->
        <div class="detail-section">
            <h3>Location Information</h3>
            <div class="location-grid">
                <div class="location-card pickup">
                    <h4>Pickup Location</h4>
                    <div class="address">{{ order.pickup_address }}</div>
                    {% if order.supplier_name %}
                    <div class="contact-info">
                        <p><strong>Supplier:</strong> {{ order.supplier_name }}</p>
                        {% if order.supplier_phone %}
                        <p><strong>Phone:</strong> {{ order.supplier_phone }}</p>
                        {% endif %}
                    </div>
                    {% endif %}
                </div>
                
                <div class="location-card delivery">
                    <h4>Delivery Location</h4>
                    <div class="address">{{ order.delivery_address }}</div>
                    {% if order.customer_name %}
                    <div class="contact-info">
                        <p><strong>Customer:</strong> {{ order.customer_name }}</p>
                        {% if order.customer_phone %}
                        <p><strong>Phone:</strong> {{ order.customer_phone }}</p>
                        {% endif %}
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Logistics Information -->
        <div class="detail-section">
            <h3>Logistics Information</h3>
            <div class="logistics-info">
                <div class="detail-item">
                    <label>Logistics Company:</label>
                    <span>{{ order.logistic_company }}</span>
                </div>
                <div class="detail-item">
                    <label>Time Slot:</label>
                    <span>{{ order.time_slot }}</span>
                </div>
            </div>
            
            {% if order.driver %}
            <div class="driver-info">
                <h4>Assigned Driver</h4>
                <div class="driver-details">
                    <p><strong>Name:</strong> {{ order.driver.name }}</p>
                    <p><strong>Phone:</strong> {{ order.driver.phone }}</p>
                    <p><strong>Email:</strong> {{ order.driver.email }}</p>
                </div>
            </div>
            {% else %}
            <div class="driver-info">
                <h4>Driver Assignment</h4>
                <p class="not-assigned">No driver has been assigned to this order yet.</p>
            </div>
            {% endif %}
        </div>
    </div>
 </div>

{% endblock %}

{% block extra_js %}
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="{{ url_for('static', filename='js/orderDetail.js') }}"></script>
{% endblock %}
